<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUZAFFAR Music Search</title>
    <script async src="https://cse.google.com/cse.js?cx=573537e3bb7684739"></script>
    <style>
        :root {
            --primary: #00ffc8;
            --secondary: #00aaff;
            --accent: #ff00aa;
            --dark: #0a0a15;
            --darker: #050510;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark);
            color: white;
            min-height: 100vh;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 200, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 170, 255, 0.08) 0%, transparent 40%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1s ease;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
        }

        .tagline {
            color: #b0b0ff;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .music-warning {
            background: rgba(255, 0, 170, 0.1);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 15px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            color: #ffaaff;
            font-weight: bold;
        }

        .search-container {
            background: rgba(20, 20, 35, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 255, 200, 0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(0, 255, 200, 0.2);
        }

        .gcse-search {
            margin-bottom: 20px;
        }

        /* Скрываем обычные результаты Google */
        .gsc-control-cse {
            background: transparent !important;
            border: none !important;
        }

        .gsc-search-box {
            margin-bottom: 20px;
        }

        /* Категории музыки */
        .music-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 25px 0;
        }

        .category-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 200, 0.2);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .category-btn:hover {
            background: rgba(0, 255, 200, 0.1);
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: var(--dark);
            border-color: transparent;
            box-shadow: 0 5px 15px rgba(0, 255, 200, 0.3);
        }

        /* История поиска */
        .history-container {
            background: rgba(20, 20, 35, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid rgba(0, 255, 200, 0.2);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 200, 0.1);
        }

        .history-title {
            font-size: 1.3rem;
            color: var(--primary);
        }

        .clear-history {
            background: rgba(255, 0, 170, 0.2);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .clear-history:hover {
            background: rgba(255, 0, 170, 0.3);
            transform: scale(1.05);
        }

        .history-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--darker);
        }

        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: var(--darker);
        }

        .history-list::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 10px;
        }

        .history-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(0, 255, 200, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
            border-left: 3px solid var(--primary);
        }

        .history-item:hover {
            background: rgba(0, 255, 200, 0.15);
            transform: translateX(5px);
        }

        .history-time {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-history {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            padding: 20px;
        }

        /* Популярные запросы */
        .popular-searches {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        .popular-title {
            color: var(--secondary);
            margin-bottom: 15px;
            text-align: center;
        }

        .popular-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .popular-item {
            padding: 8px 15px;
            background: rgba(0, 170, 255, 0.1);
            border: 1px solid rgba(0, 170, 255, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .popular-item:hover {
            background: rgba(0, 170, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Фильтр */
        .filter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .filter-message {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
            animation: pulse 2s infinite;
        }

        .filter-title {
            color: #ff4444;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .filter-text {
            color: #ffaaaa;
            margin-bottom: 20px;
        }

        .close-filter {
            background: #ff4444;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .search-container, .history-container {
                padding: 20px 15px;
            }

            .music-categories {
                gap: 8px;
            }

            .category-btn {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Фильтр не-музыкальных запросов -->
    <div class="filter-overlay" id="filterOverlay">
        <div class="filter-message">
            <div class="filter-title">⛔ МУЗЫКАЛЬНЫЙ ПОИСК ТОЛЬКО!</div>
            <div class="filter-text">
                Этот поисковик предназначен ТОЛЬКО для поиска музыки.<br>
                Запрос "<span id="blockedQuery"></span>" не связан с музыкой.
            </div>
            <p style="color: #aaa; margin: 15px 0;">
                Попробуйте: "Billie Eilish", "рэп 2024", "поп музыка", "классика"
            </p>
            <button class="close-filter" onclick="closeFilter()">Понятно</button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>MUZAFFAR MUSIC SEARCH</h1>
            <p class="tagline">Поиск ТОЛЬКО музыки, исполнителей и альбомов</p>
            
            <div class="music-warning">
                <i class="fas fa-exclamation-triangle"></i> 
                Этот поисковик работает ТОЛЬКО с музыкальными запросами
            </div>
        </header>

        <div class="search-container">
            <!-- Google Custom Search с ограничениями -->
            <div class="gcse-search" data-enableHistory="true" data-queryParameterName="q"></div>
            
            <!-- Категории музыки -->
            <div class="music-categories" id="musicCategories">
                <button class="category-btn active" data-query="поп музыка">Поп</button>
                <button class="category-btn" data-query="рэп хип-хоп">Рэп</button>
                <button class="category-btn" data-query="рок музыка">Рок</button>
                <button class="category-btn" data-query="электронная музыка">Электроника</button>
                <button class="category-btn" data-query="джаз музыка">Джаз</button>
                <button class="category-btn" data-query="классическая музыка">Классика</button>
                <button class="category-btn" data-query="инди музыка">Инди</button>
                <button class="category-btn" data-query="метал музыка">Метал</button>
            </div>

            <!-- Популярные музыкальные запросы -->
            <div class="popular-searches">
                <div class="popular-title">Популярные музыкальные запросы:</div>
                <div class="popular-list">
                    <div class="popular-item" onclick="setSearchQuery('Billie Eilish')">Billie Eilish</div>
                    <div class="popular-item" onclick="setSearchQuery('The Weeknd')">The Weeknd</div>
                    <div class="popular-item" onclick="setSearchQuery('Dua Lipa')">Dua Lipa</div>
                    <div class="popular-item" onclick="setSearchQuery('рэп 2024')">Рэп 2024</div>
                    <div class="popular-item" onclick="setSearchQuery('поп хиты')">Поп хиты</div>
                    <div class="popular-item" onclick="setSearchQuery('рок классика')">Рок классика</div>
                    <div class="popular-item" onclick="setSearchQuery('электро хаус')">Электро хаус</div>
                </div>
            </div>
            
            <!-- История музыкального поиска -->
            <div class="history-container">
                <div class="history-header">
                    <h2 class="history-title">История музыкальных запросов</h2>
                    <button class="clear-history" id="clearHistory">
                        <i class="fas fa-trash"></i> Очистить историю
                    </button>
                </div>
                <ul class="history-list" id="historyList">
                    <!-- История будет загружена сюда -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Словарь музыкальных терминов для фильтрации
        const MUSIC_KEYWORDS = [
            'музыка', 'music', 'песня', 'song', 'трек', 'track', 'сингл', 'single',
            'альбом', 'album', 'исполнитель', 'artist', 'группа', 'band', 'пев', 'singer',
            'гитар', 'guitar', 'барабан', 'drum', 'клавиш', 'piano', 'скрипк', 'violin',
            'поп', 'pop', 'рэп', 'rap', 'хип-хоп', 'hip-hop', 'hip hop', 'рок', 'rock',
            'электро', 'electronic', 'техно', 'techno', 'хаус', 'house', 'джаз', 'jazz',
            'блюз', 'blues', 'классик', 'classical', 'метал', 'metal', 'инди', 'indie',
            'фолк', 'folk', 'кантри', 'country', 'регги', 'reggae', 'соул', 'soul',
            'диско', 'disco', 'фанк', 'funk', 'хип', 'hop', 'транс', 'trance', 'дабстеп', 'dubstep',
            'бит', 'beat', 'ритм', 'rhythm', 'мелоди', 'melody', 'гармон', 'harmony',
            'аккорд', 'chord', 'нота', 'note', 'текст', 'lyric', 'припев', 'chorus',
            'куплет', 'verse', 'мост', 'bridge', 'аранжиров', 'arrangement', 'композиц', 'composition'
        ];

        // Популярные исполнители и группы
        const ARTISTS = [
            'billie', 'eilish', 'weeknd', 'dua', 'lipa', 'taylor', 'swift', 'ed', 'sheeran',
            'ariana', 'grande', 'drake', 'kanye', 'west', 'beyonce', 'rihanna', 'bruno', 'mars',
            'justin', 'bieber', 'selena', 'gomez', 'shakira', 'madonna', 'elton', 'john',
            'queen', 'beatles', 'nirvana', 'led', 'zeppelin', 'ac/dc', 'metallica', 'linkin', 'park',
            'eminem', 'snoop', 'dog', 'kendrick', 'lamar', 'travis', 'scott', 'post', 'malone'
        ];

        // Запрещенные темы (не музыка)
        const BANNED_TOPICS = [
            'порно', 'porno', 'секс', 'sex', 'нарко', 'drug', 'оружи', 'weapon', 'оружие',
            'войн', 'war', 'политик', 'politic', 'религи', 'religion', 'криминал', 'crime',
            'хакинг', 'hacking', 'взлом', 'hack', 'вирус', 'virus', 'мошенни', 'scam',
            'насили', 'violence', 'убийств', 'murder', 'террор', 'terror', 'экстремизм'
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация базы данных
            let db;
            const DB_NAME = 'MUZAFFARMusicDB';
            const DB_VERSION = 1;
            const STORE_NAME = 'musicSearchHistory';
            
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            
            request.onerror = function(event) {
                console.error('Ошибка IndexedDB:', event.target.error);
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                loadHistory();
            };
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    const store = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                    store.createIndex('query', 'query', { unique: false });
                    store.createIndex('timestamp', 'timestamp', { unique: false });
                }
            };
            
            // Загрузка истории
            function loadHistory() {
                if (!db) return;
                
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const index = store.index('timestamp');
                const request = index.openCursor(null, 'prev');
                
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                
                request.onsuccess = function(event) {
                    const cursor = event.target.result;
                    if (cursor) {
                        const item = cursor.value;
                        if (isMusicRelated(item.query)) {
                            const li = document.createElement('li');
                            li.className = 'history-item';
                            li.innerHTML = `
                                <span>${item.query}</span>
                                <span class="history-time">${formatDate(item.timestamp)}</span>
                            `;
                            
                            li.addEventListener('click', function() {
                                setSearchQuery(item.query);
                            });
                            
                            historyList.appendChild(li);
                        }
                        cursor.continue();
                    } else if (historyList.children.length === 0) {
                        historyList.innerHTML = '<li class="empty-history">История поиска музыки пуста</li>';
                    }
                };
            }
            
            // Проверка, является ли запрос музыкальным
            function isMusicRelated(query) {
                if (!query) return false;
                
                const queryLower = query.toLowerCase();
                
                // Проверка на запрещенные темы
                for (const banned of BANNED_TOPICS) {
                    if (queryLower.includes(banned)) {
                        return false;
                    }
                }
                
                // Проверка на музыкальные ключевые слова
                for (const keyword of MUSIC_KEYWORDS) {
                    if (queryLower.includes(keyword)) {
                        return true;
                    }
                }
                
                // Проверка на популярных исполнителей
                for (const artist of ARTISTS) {
                    if (queryLower.includes(artist)) {
                        return true;
                    }
                }
                
                return false;
            }
            
            // Форматирование даты
            function formatDate(timestamp) {
                const date = new Date(timestamp);
                return date.toLocaleString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Очистка истории
            document.getElementById('clearHistory').addEventListener('click', function() {
                if (confirm('Очистить всю историю музыкальных запросов?')) {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.clear();
                    
                    request.onsuccess = function() {
                        loadHistory();
                    };
                }
            });
            
            // Установка запроса в поиск
            function setSearchQuery(query) {
                const input = document.querySelector('.gsc-input-box input');
                if (input) {
                    input.value = query;
                    input.focus();
                    
                    const event = new Event('input', { bubbles: true });
                    input.dispatchEvent(event);
                }
            }
            
            // Сохранение запроса в историю
            function saveQueryToHistory(query) {
                if (!query.trim() || !isMusicRelated(query)) return false;
                
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                
                const item = {
                    query: query,
                    timestamp: Date.now()
                };
                
                store.add(item);
                
                transaction.oncomplete = function() {
                    loadHistory();
                };
                
                return true;
            }
            
            // Блокировка не-музыкальных запросов
            function blockNonMusicQuery(query) {
                if (!query.trim()) return false;
                
                if (!isMusicRelated(query)) {
                    document.getElementById('blockedQuery').textContent = query;
                    document.getElementById('filterOverlay').style.display = 'flex';
                    return true;
                }
                return false;
            }
            
            // Закрытие фильтра
            window.closeFilter = function() {
                document.getElementById('filterOverlay').style.display = 'none';
                const input = document.querySelector('.gsc-input-box input');
                if (input) {
                    input.value = '';
                    input.focus();
                }
            };
            
            // Обработка категорий музыки
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const query = this.dataset.query;
                    setSearchQuery(query);
                });
            });
            
            // Популярные запросы
            window.setSearchQuery = function(query) {
                if (blockNonMusicQuery(query)) {
                    return;
                }
                
                const input = document.querySelector('.gsc-input-box input');
                if (input) {
                    input.value = query;
                    input.focus();
                    
                    const event = new Event('input', { bubbles: true });
                    input.dispatchEvent(event);
                }
            };
            
            // Перехват поиска Google Custom Search
            let searchTimer;
            document.addEventListener('submit', function(event) {
                if (event.target.classList.contains('gsc-search-box')) {
                    event.preventDefault();
                    
                    const input = event.target.querySelector('.gsc-input-box input');
                    if (input && input.value) {
                        const query = input.value.trim();
                        
                        if (blockNonMusicQuery(query)) {
                            return;
                        }
                        
                        if (saveQueryToHistory(query)) {
                            // Запускаем поиск через Google CSE
                            clearTimeout(searchTimer);
                            searchTimer = setTimeout(() => {
                                const searchButton = document.querySelector('.gsc-search-button');
                                if (searchButton) {
                                    searchButton.click();
                                }
                            }, 100);
                        }
                    }
                }
            }, true);
            
            // Проверка ввода в реальном времени
            const searchInput = document.querySelector('.gsc-input-box input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    if (query.length > 3 && !isMusicRelated(query)) {
                        this.style.borderColor = '#ff4444';
                        this.style.boxShadow = '0 0 10px rgba(255, 68, 68, 0.5)';
                    } else {
                        this.style.borderColor = '';
                        this.style.boxShadow = '';
                    }
                });
            }
            
            // Настройка Google CSE для поиска музыки
            const script = document.createElement('script');
            script.innerHTML = `
                (function() {
                    var cx = '573537e3bb7684739';
                    var gcse = document.createElement('script');
                    gcse.type = 'text/javascript';
                    gcse.async = true;
                    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(gcse, s);
                })();
            `;
            document.head.appendChild(script);
        });
    </script>
</body>
</html>
